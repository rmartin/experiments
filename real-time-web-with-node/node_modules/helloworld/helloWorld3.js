'use strict';

var fs = require('fs'),
	ASQ = require('asynquence'),
	ASQR = require('asynquence-contrib');

var delayMsg = function(done, contents) {
	setTimeout(function() {
		done(contents);
	}, 1000);
};

var readFile = function(filename) {
	return ASQ(function(done) {
		var stream = fs.createReadStream(filename);
		var contents = '';

		stream.pipe(fs.createWriteStream(filename + '.backup'));

		stream.on('data', function(chunk) {
			contents += chunk;
		});
		stream.on('end', function() {
			done(contents);
		});
	});
};

var say = function(filename, cb) {
	return readFile(filename)
		.then(delayMsg);
};
module.exports.say = say;